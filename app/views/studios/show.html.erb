<% options = [] %>
<% new_page = @current_studio.pages_enabled? ? 'new_page' : nil %>
<% new_randomness = @current_studio.random_enabled? ? 'new_randomness' : nil %>
<% invite = @current_user.studio_user.can_invite? ? 'invite' : nil %>
<% representation = 'representation' %>
<% options << new_page if new_page %>
<% options << new_randomness if new_randomness %>
<% options << invite if invite %>
<% options << representation if representation %>
<% settings = @current_user.studio_user.is_admin? ? 'settings' : nil %>
<% options << '---' if settings %>
<% options << settings if settings %>
<% options << 'manage_team' if @current_user.studio_user.is_admin? %>
<%= render 'shared/more_button', resource: @current_studio, options: options %>

<h4 style="margin-top:0px;margin-bottom:0;">Studio</h4>
<h1 style="margin-top:0;"><%= @current_studio.name %></h1>

<h4>
  Current Cycle:
  <a href="<%= @cycle.path %>"><%= @cycle.display_window %></a>
</h4>

<h2><%= octicon 'pin', height: 24 %> Pinned</h2>
<%= render 'pinned' %>

<h2><%= octicon 'iterations', height: 24 %> Sequences</h2>

<% if @current_studio.sequences.any? %>
  <% @current_studio.sequences.each do |sequence| %>
    <h4>
      <a href="<%= sequence.path %>"><%= sequence.title %></a>
    </h4>
    <% if sequence.completed? %>
      <div>
        <%= octicon 'check' %>
        sequence completed <%= timeago(sequence.ends_at) %>
      </div>
    <% elsif sequence.paused? %>
      <div>
        <%= octicon 'tab' %>
        sequence paused <%= timeago(sequence.paused_at) %>
      </div>
    <% else %>
      <div>
        <%= octicon 'arrow-right' %>
        #<%= sequence.next_item_position %>
        <span class="smaller-text">
          will be created in
          <%= countdown(sequence.next_item_scheduled_at) %>
        </span>
      </div>
    <% end %>
    <% if sequence.last_item %>
      <div>
        <%= octicon 'arrow-right' %>
        <a href="<%= sequence.last_item.path %>">#<%= sequence.last_item.sequence_position %></a>
        created <%= timeago(sequence.last_item.created_at) %>
      </div>
    <% end %>
    <% past_items = sequence.past_items.limit(3) %>
    <% if past_items.any? %>
      <div>
        <%= octicon 'arrow-right' %>
        <% past_items.each do |item| %>
          <a href="<%= item.path %>">#<%= item.sequence_position %></a>
          <% if item == past_items.last %>
            , ...
          <% else %>
            ,
          <% end %>
        <% end %>
      </div>
    <% end %>
  <% end %>
<% else %>
  <p><em>No active sequences right now.</em></p>
<% end %>

<% if false %>
  <h2>
    <%= octicon 'calendar', height: 24 %>
    <a href="<%= @cycle.path %>"><%= @cycle.display_window %></a>
  </h2>

  <%= render 'shared/collapseable_section', title: 'Notes', header_level: 3, hidden: true do %>
    <ul>
    <% @cycle.notes.each do |note| %>
      <li>
        <a href="<%= note.path %>"><i class="note-icon"></i> <%= note.title %></a> <%= note.attachments.any? ? octicon('paperclip') : '' %>
      </li>
    <% end %>
    <% if @cycle.notes.empty? %>
      <li>
        <em>No active notes <%= @cycle.display_name.downcase %>.</em>
      </li>
    <% end %>
    </ul>
  <% end %>

  <%= render 'shared/collapseable_section', title: 'Decisions', header_level: 3, hidden: true do %>
    <ul>
    <% @cycle.decisions.each do |decision| %>
      <li>
        <a href="<%= decision.path %>"><i class="decision-icon"></i> <%= decision.question %></a>
      </li>
    <% end %>
    <% if @cycle.decisions.empty? %>
      <li>
        <em>No active decisions <%= @cycle.display_name.downcase %>.</em>
      </li>
    <% end %>
    </ul>
  <% end %>

  <%= render 'shared/collapseable_section', title: 'Commitments', header_level: 3, hidden: true do %>
    <ul>
    <% @cycle.commitments.each do |commitment| %>
      <li>
        <a href="<%= commitment.path %>"><i class="commitment-icon"></i> <%= commitment.title %></a>
      </li>
    <% end %>
    <% if @cycle.commitments.empty? %>
      <li>
        <em>No active commitments <%= @cycle.display_name.downcase %>.</em>
      </li>
    <% end %>
    </ul>
  <% end %>
<% end %>

<h2>
  <%= octicon 'file-symlink-file', height: 24 %>
  Backlinks
</h2>
<% if @cycle.backlinks.any? %>
  <p>Items that are linked to by <%= @cycle.display_name.downcase %>'s active items.</p>
  <ul>
  <% @cycle.backlinks.each do |resource| %>
    <li>
      <a href="<%= resource.path %>"><i class="<%= resource.class.to_s.downcase %>-icon"></i> <%= resource.title %></a>
    </li>
  <% end %>
  </ul>
<% else %>
  <p><em>No items are linked to by <%= @cycle.display_name.downcase %>'s active items.</em></p>
<% end %>

<h2>
  <%= octicon 'people', height: 24 %>
  Team
</h2>
<%= render 'team' %>
